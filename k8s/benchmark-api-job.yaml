apiVersion: batch/v1
kind: Job
metadata:
  name: arbm-api-benchmark
  namespace: arbm-benchmark
spec:
  backoffLimit: 1
  ttlSecondsAfterFinished: 86400
  template:
    spec:
      restartPolicy: Never
      tolerations:
      - key: "nvidia.com/gpu"
        operator: "Exists"
        effect: "NoSchedule"
      containers:
      - name: benchmark
        image: docker.io/vllm/vllm-openai:v0.6.6
        imagePullPolicy: IfNotPresent
        resources:
          limits:
            memory: "4Gi"
            cpu: "2"
          requests:
            memory: "2Gi"
            cpu: "1"
        env:
        - name: ANTHROPIC_API_KEY
          value: "PLACEHOLDER_KEY"
        command: ["/bin/bash", "-c"]
        args:
        - |
          echo "=== ARBM API Benchmark ==="
          echo "Testing network connectivity..."
          curl -s --connect-timeout 5 https://api.anthropic.com -o /dev/null && echo "OK: Can reach Anthropic API" || echo "FAIL: Cannot reach Anthropic API"
          echo ""
          python3 /mnt/fss/ARBM/scripts/run_api_benchmark.py
        volumeMounts:
        - name: fss
          mountPath: /mnt/fss
      volumes:
      - name: fss
        hostPath:
          path: /mnt/coecommonfss/llmcore
